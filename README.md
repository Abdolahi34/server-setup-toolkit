# Server Setup Toolkit

این پروژه شامل چند اسکریپت برای راه‌اندازی اولیه سرور Ubuntu، ایمن‌سازی SSH و دریافت اعلان لاگین‌ها از طریق تلگرام است.  
هدف این است که بتوانید با چند دستور ساده، سرور خود را آماده استفاده کرده و امنیت اولیه آن را تضمین کنید.

## 📂 ساختار پروژه

```
server-setup-toolkit/
│
├── scripts/
│   ├── ubuntu-init-setup.sh     # اسکریپت اصلی تنظیمات اولیه سرور
│   ├── firewall-lockdown.sh     # بستن تمام پورت‌ها به جز SSH
│   ├── setup-ssh-notify.sh      # ارسال اعلان لاگین SSH به تلگرام
│
├── windows/
│   └── build-ssh-key.bat        # ساخت کلید SSH در ویندوز
│
├── linux/
│   └── build-ssh-key.sh         # ساخت کلید SSH در لینوکس
│
└── README.md                    # راهنمای استفاده
```

## ⚙️ پیش‌نیازها

- سرور Ubuntu (ترجیحاً نسخه LTS - تست شده روی 24.04)
- دسترسی **root** به سرور
- یک **کلید SSH** برای ورود امن
- (اختیاری) ربات تلگرام برای اعلان ورودها

## 🚀 مراحل نصب و استفاده

### ۱. ساخت کلید SSH (در ویندوز یا لینوکس)

#### 🔹 ویندوز

روی کامپیوتر خود فایل زیر را اجرا کنید:

```
windows\build-ssh-key.bat
```

- از شما نامی برای سرور/پروژه پرسیده می‌شود (مثلاً `server1`).  
- کلیدها در مسیر `%USERPROFILE%\.ssh` ساخته می‌شوند.  
- فایل‌ها به این شکل خواهند بود:
  - کلید خصوصی - محرمانه `id_ed25519_server1`
  - کلید عمومی - قابل اشتراک با سرور `id_ed25519_server1.pub`

#### 🔹 لینوکس / مک

روی سیستم خود این فایل را اجرا کنید:

```
bash build-ssh-key.sh
```

- مشابه ویندوز، نامی برای سرور/پروژه می‌گیرید.  
- کلیدها در مسیر `~/.ssh/` ساخته می‌شوند:
  - کلید خصوصی - محرمانه `id_ed25519_server1`
  - کلید عمومی - قابل اشتراک با سرور `id_ed25519_server1.pub`

⚠️ **نکته امنیتی:**
- کلید خصوصی (`id_ed25519_server1`) را فقط روی سیستم خود نگه دارید.  
- فقط کلید عمومی (`.pub`) را در سرور قرار دهید. 

---

### ۲. اجرای تنظیمات اولیه (روی سرور)

ابتدا اسکریپت را روی سرور کپی کنید و اجرا کنید:

```
cd scripts
sudo bash ubuntu-init-setup.sh
```

این اسکریپت:

- یک کاربر جدید بدون پسورد ایجاد می‌کند.
- کلید SSH شما را اضافه می‌کند.
- دسترسی روت از طریق SSH را می‌بندد.
- احراز هویت با رمز عبور را غیرفعال می‌کند (فقط کلید مجاز است).
- پورت SSH را تغییر می‌دهد.
- UFW (فایروال) را نصب و فعال می‌کند.
- آپدیت‌های امنیتی خودکار را فعال می‌کند.
- ساعت و منطقه زمانی را روی **Asia/Tehran** تنظیم می‌کند.

در پایان اسکریپت به شما دستور SSH برای اتصال جدید نمایش می‌دهد.

---

### ۳. تست اتصال

قبل از هر اقدامی:

- با کاربر جدید و پورت جدید به سرور وصل شوید.
- مطمئن شوید ورود با کلید SSH موفق است.

---

### ۴. قفل کردن فایروال

بعد از اینکه اتصال جدید درست کار کرد:

```bash
sudo bash firewall-lockdown.sh
```

این اسکریپت:

- همه پورت‌های ورودی را می‌بندد.
- فقط پورت SSH (که موقع اجرا این فایل وارد می‌کنید) را باز می‌گذارد.

---

### ۵. اعلان ورود SSH در تلگرام (اختیاری)

برای فعال‌سازی اعلان‌ها:

```bash
sudo bash setup-ssh-notify.sh
```

اطلاعات موردنیاز:

- **Server Name** (نام سرور برای نمایش در پیام‌ها)
- **Bot Token** (توکن ربات تلگرام)
- **Chat ID** (آیدی کاربری یا گروه تلگرام)

از این پس هر ورود SSH به سرور، یک پیام به تلگرام شما ارسال خواهد کرد.

## 🔒 نکات امنیتی مهم

- همیشه بعد از تغییر پورت SSH و کلیدگذاری، **قبل از بستن پورت‌ها** اتصال جدید را تست کنید.
- کلید خصوصی (`id_ed25519`) فقط روی سیستم خودتان بماند. هیچ‌وقت روی سرور آپلود نکنید.
- برای افزایش امنیت، می‌توانید Fail2Ban یا ابزارهای دیگر را هم اضافه کنید.
- توصیه می‌شود از **Ubuntu LTS** استفاده کنید.

## ❓ پرسش‌های متداول (FAQ)

### ❔ چرا نمی‌توانم بعد از اجرا وارد سرور شوم؟

- احتمالاً پورت SSH را درست وارد نکرده‌اید.
- مطمئن شوید کلید عمومی درست روی سرور قرار گرفته باشد.
- قبل از اجرای `firewall-lockdown.sh` حتماً اتصال جدید را تست کنید.

### ❔ چگونه کلید جدید بسازم؟

- در ویندوز: `windows\build-ssh-key.bat`
- در لینوکس/مک: دستور زیر را بزنید:`linux\build-ssh-key.sh`

### ❔ اعلان تلگرام کار نمی‌کند؟

- Bot Token یا Chat ID اشتباه وارد شده.
- مطمئن شوید سرور شما به اینترنت و Telegram API دسترسی دارد.
